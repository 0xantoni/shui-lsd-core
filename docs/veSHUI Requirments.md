### **功能需求**

1. **钱包集成**  
   1. 用户可以通过调用钱包将自己的 SHUI 地址进行锁定操作。  
2. **锁定机制**  
   1. 用户可以将 SHUI 锁定为 veSHUI。  
   2. 锁定期限分为：0.5 年、1 年、2 年、4 年。  
      * 1 SHUI 锁定 0.5年获得 0.125个veSHUI  
      * 1 SHUI 锁定1年获得0.25个veSHUI  
      * 1 SHUI 锁定2年获得0.5个veSHUI  
      * 1 SHUI 锁定4年获得1个veSHUI  
   3. 所有veSHUI累计会获得 50% 的 SHUI 合约质押服务产生的收入。  
   4. 收入类型为 CFX 代币。  
   5. 用户 stake 后第二日 0 点生效
      - 合约中会以日为单位存储用户 stake 日期。方便用 map 方式统计需要更新票权的用户。
   6. 合约中不支持复杂的时间计算，所以会 1 年以 365 天计
3. **收入分配**  
   1. veSHUI 持有者将获得 SHUI 合约服务产生的收入。  
   2. 合约会根据池子中注入的 cfx 数量计算每个用户的实时收益。每次注入时会根据每个用户 两个收益注入时间点之间的票权和时间乘积 来分配收益。
      - 需求中为每月 1 日发放，但由于前端需要展示用户收益，建议至少每日 更新一次 veShui 池子收益。更新方式为往该合约转 cfx，Receive 函数实现 payable
   3. 收益领取建议由用户手动发起 claim，可随时发起。
4. **锁定管理**  
   1. 用户锁定后的 veSHUI 不可以提前解锁。  
   2. 用户在一次质押后不能添加份额。例如，用户地址里有 2000 个 SHUI，如果他选择了 1000 个 SHUI 锁定 1 年，那么他不能在这一份额上添加锁定更多的 SHUI。  
   3. 用户可以选择再次提交锁定请求。例如，用户再次锁定 1000 个 SHUI，新的锁定期限从第二次提交的时刻开始计算。  
5. **用户界面**  
   1. 锁定 SHUI 的操作页面，包含选择锁定期限（0.5 年、1 年、2 年、4 年）。  
   2. 查看当前锁定的 veSHUI 和锁定期限。  
      * 当用户Lock或Unlock SHUI时候同步显示持有的veSHUI的voting rights  
   3. 收益分配查看页面，展示用户当前获得的 CFX 收益。  
      * **用户界面**  
        * 锁定 SHUI 的操作页面，包含选择锁定期限（0.5 年、1 年、2 年、4 年）。  
        * 查看当前锁定的 veSHUI 和锁定期限。  
          * 当用户Lock或Unlock SHUI时候同步显示持有的veSHUI的voting rights  
        * 收益分配查看页面，展示用户当前获得的 CFX 收益。  
          * Action  
            * 用户操作锁定后显示 Lock  
            * 当用户进行UnLock操作后显示Unlock的情况  
          * Amount  
            * Lock/Unlock 的shui token的数量，显示小数点后四位  
          * Rewards  
            * 显示锁定的这一批SHUI token每日获得了多少枚 CFX 分润，显示小数点后四位。每日同步一次  
          * Unlock Time  
            * 显示解锁的时间：年/月/日  
          * Date  
            * 显示锁定操作的时间：年/月/日  
6. **用户流程**  
   1. 锁定SHUI  
      * 用户连接钱包到SHUI dApp  
      * 用户点击DAO，进入锁定SHUI的页面  
      * 用户填入想要锁定 SHUI 的数量，并选择锁定期限。  
      * 用户点击Lock veSHUI 向合约发起交互  
      * 用户钱包内获得相等数量的veSHUI Token  
   2. 解锁veSHUI  
      * 用户点击DAO，进入解锁SHUI的页面。  
      * 向链上拉取用户此时可以解锁的veSHUI的数量。  
      * 用户填入想要解锁 veSHUI 的数量。  
      * 用户点击Unlock SHUI 向合约发起交互。  
      * 用户钱包内获得相等数量的SHUI Token，veSHUI token销毁


讨论：
1. 合约会根据池子中注入的 cfx 数量计算每个用户的实时收益。每次注入时会根据每个用户 两个收益注入时间点之间的票权和时间乘积 来分配收益。
   - 需求中为每月 1 日发放，但由于前端需要展示用户收益，建议至少每日 更新一次 veShui 池子收益。更新方式为往该合约转 cfx，Receive 函数实现 payable
2. 收益领取建议由用户手动发起 claim，可随时发起。
3. 用户 stake 后第二日 0 点生效
   - 合约中会以日为单位存储用户 stake 日期。方便用 map 方式统计需要更新票权的用户。
4. 合约中不支持复杂的时间计算，所以会 1 年以 365 天计
5. 票权到期后是否支持自动复投？（将来迭代）